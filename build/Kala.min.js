var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es6","es3");function Vec2(a,b){return new Vec2.init(a,b)}Vec2.init=function(a,b){this.x=a;this.y=b};
Vec2.init.prototype=Vec2.prototype;Vec2.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vec2.prototype.add=function(a){return Vec2(a.x+this.x,a.y+this.y)};Vec2.prototype.subtract=function(a){return Vec2(this.x-a.x,this.y-a.y)};Vec2.prototype.scale=function(a){return Vec2(this.x*a,this.y*a)};Vec2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};Vec2.prototype.cross=function(a){return this.x*a.y-this.y*a.x};
Vec2.prototype.rotate=function(a,b){var c=[],d=this.x-a.x,e=this.y-a.y;c[0]=d*Math.cos(b)-e*Math.sin(b);c[1]=d*Math.sin(b)+e*Math.cos(b);c[0]+=a.x;c[1]+=a.y;return Vec2(c[0],c[1])};Vec2.prototype.normalize=function(){var a=this.length();0<a&&(a=1/a);return Vec2(this.x*a,this.y*a)};Vec2.prototype.distance=function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)};Vec2.prototype.vectorFromAngle=function(a,b){return Vec2(a*Math.cos(b),a*Math.sin(b))};
Vec2.prototype.angleFromVector=function(a){return Math.atan2(this.y-a.y,this.x-a.x)};
function Engine(){var a=this;this.movement=!1;this.currentTime;this.elapsedTime;this.previousTime=performance.now();this.lagTime=0;this.kFPS=60;this.updateIntervalInSeconds=this.frameTime=1/this.kFPS;this.kMPF=1E3*this.frameTime;this.allBodies=[];this.allConstraints=[];this.physics=new Kala.Physics;this.events=new Kala.Events;this.collisionResponse;this.gravity=Vec2(0,10);new Indexer;this.add=function(b){if(Array.isArray(b))b.forEach(function(b){b instanceof Body&&(a.allBodies.push(b),a.applyGravity(a.allBodies[a.allBodies.length-
1]))});else if(b instanceof Body)a.allBodies.push(b),this.applyGravity(a.allBodies[a.allBodies.length-1]);else throw"Only objects of type Body can be added to the engine";};this.removeBody=function(a){this.allBodies.splice(a,1)};this.addConstraint=function(a){this.allConstraints.push(a)};this.applyGravityAllBodies=function(){for(var b=0;b<a.allBodies.length;b++)this.applyGravity(a.allBodies[b])};this.applyGravity=function(a){a.acceleration=0!==a.invMass?this.gravity:Vec2(0,0)};this.update=function(){for(var a=
0;a<this.allBodies.length;a++)this.allBodies[a].update(this)};this.runGameLoop=function(b){requestAnimationFrame(function(){a.runGameLoop(b)});a.currentTime=performance.now();a.elapsedTime=a.currentTime-a.previousTime;a.previousTime=a.currentTime;for(a.lagTime+=a.elapsedTime;a.lagTime>=a.kMPF;)a.lagTime-=a.kMPF,this.collisionInfo=this.physics.collision(this),this.update();0!=this.allConstraints.length&&this.physics.maintainConstraints(a);this.events.customEvents&&Object.values(this.events.customEvents).forEach(function(a){a.call()});
this.collisionInfo&&Object.values(this.events.collisionEvents).forEach(function(a){a.call()});b&&b.update(this)};this.initializeEngineCore=function(b){a.runGameLoop(b)}}
function PixiRender(a,b,c,d){var e,f;function g(){e=PIXI.Sprite.from("imgs/circle.png").texture;switch(c){case "stone":f=m.loader.resources.sheet.textures["elementMetal011.png"];break;case "space":f=m.loader.resources.ship.texture;e=m.loader.resources.asteroid1.texture;break;case "pool":f=m.loader.resources.wood.texture}}var h=this,m=this;this.app=new PIXI.Application({height:a,width:b,backgroundColor:16579791,forceCanvas:!0,antialias:!0});this.scale=d;document.body.appendChild(this.app.view);this.app.stage.scale.x=
this.app.stage.scale.y=d;this.bodyContainer=new PIXI.Container;var k=new PIXI.Graphics;this.loader=new PIXI.Loader;this.isLoaded=!1;c=c||"stone";f=e=void 0;switch(c){case "space":this.loader.add("ship","imgs/AsteroidGame/enemyBlue3.png").add("asteroid1","imgs/AsteroidGame/meteorBrown_big1.png").add("explosion","imgs/AsteroidGame/ExplosionAnimation.json").load(g);break;case "stone":this.loader.add("sheet","imgs/spritesheet_metal.json").load(g);break;case "pool":this.loader.add("wood","imgs/PoolGameImgs/woodTexture.jpg").add("whiteball",
"imgs/PoolGameImgs/whiteball.png").add("poolballs","imgs/PoolGameImgs/redball.png").add("pot","imgs/PoolGameImgs/pot.png").load(g)}this.app.stage.addChild(this.bodyContainer);this.app.stage.addChild(k);this.loader.onComplete.add(function(){h.isLoaded=!0});this.addRect=function(a){var b=this.graphics.drawRect(0,0,a.width,a.height);b.pivot.set(b.width/2,b.height/2);b.position.x=a.center.x;b.position.y=a.center.y;a=this.graphics.drawRect(b.width/2,b.height/2,1,1);this.allRenderBodies.push(b);this.app.stage.addChild(b);
this.app.stage.addChild(a)};this.addSprite=function(a){if("Rectangle"===a.type){var b=new PIXI.Sprite(f);b.anchor.x=b.anchor.y=.5;b.position.x=a.center.x;b.position.y=a.center.y;b.width=a.width;b.height=a.height;this.bodyContainer.addChild(b)}"Circle"===a.type&&(b=new PIXI.Sprite(e),b.anchor.x=b.anchor.y=.5,b.height=b.width=2*a.radius,b.position.x=a.center.x,b.position.y=a.center.y,this.bodyContainer.addChild(b))};this.addSprites=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this.addSprite(a[b]);
else this.addSprite(a)};this.removeSprite=function(a){a=this.bodyContainer.getChildAt(a);void 0!=a&&this.bodyContainer.removeChild(a)};this.drawLine=function(a,b,c,d){k.clear();k.lineStyle(.1,0,1);k.moveTo(a,b);k.lineTo(c,d)};this.update=function(a){for(var b=a.allBodies,c=0;c<this.bodyContainer.children.length;c++){var d=b[c],e=this.bodyContainer.children[c],f=d.center.y,g=d.angle,h=d.width,k=d.height,l=2*d.radius;e.position.x=d.center.x;e.position.y=f;e.rotation=g;e.width=d.radius?l:h;e.height=
l?l:k}a.allConstraints.forEach(function(a){m.drawLine(a.bodyA.center.x,a.bodyA.center.y,a.bodyB.center.x,a.bodyB.center.y)})}}
function Physics(){var a=function(a,c,d){if(0!==a.invMass||0!==c.invMass){var b=a.invMass,f=c.invMass,g=d.getDepth()/(b+f)*.8,g=d.getNormal().scale(g);a.move(g.scale(-b));c.move(g.scale(f));b=d.getNormal();f=d.start.scale(c.invMass/(a.invMass+c.invMass));d=d.end.scale(a.invMass/(a.invMass+c.invMass));f=f.add(d);d=f.subtract(a.center);var f=f.subtract(c.center),g=a.velocity.add(Vec2(-1*a.angularVelocity*d.y,a.angularVelocity*d.x)),g=c.velocity.add(Vec2(-1*c.angularVelocity*f.y,c.angularVelocity*f.x)).subtract(g),
h=g.dot(b);if(!(0<h)){var m=Math.min(a.restitution,c.restitution),k=Math.min(a.friction,c.friction),l=d.cross(b),n=f.cross(b),h=-(1+m)*h/(a.invMass+c.invMass+l*l*a.inertia+n*n*c.inertia),p=b.scale(h);a.velocity=a.velocity.subtract(p.scale(a.invMass));c.velocity=c.velocity.add(p.scale(c.invMass));a.angularVelocity-=l*h*a.inertia;c.angularVelocity+=n*h*c.inertia;b=g.subtract(b.scale(g.dot(b)));b=b.normalize().scale(-1);d=d.cross(b);f=f.cross(b);g=-(1+m)*g.dot(b)*k;g/=a.invMass+c.invMass+d*d*a.inertia+
f*f*c.inertia;g>h&&(g=h);p=b.scale(g);a.velocity=a.velocity.subtract(p.scale(a.invMass));c.velocity=c.velocity.add(p.scale(c.invMass));a.angularVelocity-=d*g*a.inertia;c.angularVelocity+=f*g*c.inertia}}};return{collision:function(b){var c,d,e,f=new CollisionInfo;for(e=0;15>e;e++)for(c=0;c<b.allBodies.length;c++)for(d=c+1;d<b.allBodies.length;d++)if(b.allBodies[c].boundTest(b.allBodies[d])&&b.allBodies[c].collisionTest(b.allBodies[d],f)){0>f.getNormal().dot(b.allBodies[d].center.subtract(b.allBodies[c].center))&&
f.changeDir();if(!0===b.allBodies[c].isSensor||!0===b.allBodies[d].isSensor)return f.bodyA=b.allBodies[c],f.bodyAIndex=c,f.bodyB=b.allBodies[d],f.bodyBIndex=d,f;a(b.allBodies[c],b.allBodies[d],f)}},maintainConstraints:function(b){var c,d=new CollisionInfo;for(c=0;c<b.allConstraints.length;c++)b.allConstraints[c].maintainConstraint(b,d)&&a(b.allConstraints[c].bodyA,b.allConstraints[c].bodyB,d)},positionalCorrectionFlag:!0}}var Common={};
(function(){Common.extend=function(a,b){var c=Object.create(b.prototype);c.constructor=a;a.prototype=c;return a}})();function Indexer(){this.bodyIndex=-1}Indexer.prototype.incrementIndex=function(){return this.bodyIndex+=1};function Events(){this.customEvents={};this.collisionEvents={}}Events.prototype.addCustomEvent=function(a){this.customEvents[a.name]=a};Events.prototype.addCollisionEvent=function(a){this.collisionEvents[a.name]=a};var bodyIndex=new Indexer;
function Body(a,b,c,d,e,f){this.renderIndex;this.bodyIndex=bodyIndex.incrementIndex();this.center=Vec2(a,b);this.inertia=0;this.invMass=void 0!==c?c:1;this.friction=void 0!==d?d:.8;this.restitution=void 0!==e?e:.2;this.velocity=Vec2(0,0);0!==this.invMass&&(this.invMass=1/this.invMass);this.acceleration=Vec2(0,0);this.boundRadius=this.angularAcceleration=this.angularVelocity=this.angle=0;this.isSensor=!1;this.dampenValue=.985;f&&(this.isSensor=void 0!=f.isSensor?f.isSensor:!1,this.name=f.name&&"string"===
typeof f.name?f.name:"unnamed",this.dampen=f.dampen&&"boolean"===typeof f.dampen?f.dampen:!1,f.dampenValue&&(this.dampenValue=f.dampenValue),this.bodyPositionalCorrection=f.bodyPositionalCorrection?f.bodyPositionalCorrection:!0)}
Body.prototype.update=function(a){a.movement&&(a=a.updateIntervalInSeconds,this.velocity=this.velocity.add(this.acceleration.scale(a)),this.dampen&&(this.velocity=this.velocity.scale(this.dampenValue),this.angularVelocity*=this.dampenValue),this.move(this.velocity.scale(a)),this.angularVelocity+=this.angularAcceleration*a,this.rotate(this.angularVelocity*a))};Body.prototype.boundTest=function(a){var b=a.center.subtract(this.center);a=this.boundRadius+a.boundRadius;return b.length()>a?!1:!0};
Body.prototype.updateMass=function(a){var b;b=0!==this.invMass?1/this.invMass:0;b+=a;0>=b?(this.invMass=0,this.velocity=Vec2(0,0),this.acceleration=Vec2(0,0),this.angularAcceleration=this.angularVelocity=0):this.invMass=1/b;this.updateInertia()};Body.prototype.addAcceleration=function(a){this.acceleration=this.acceleration.add(a)};Body.prototype.subtractAcceleration=function(a){this.acceleration=this.acceleration.subtract(a)};Body.prototype.updateInertia=function(){};
function CollisionInfo(){this.bodyA;this.bodyB;this.bodyAIndex;this.bodyBIndex;this.depth=0;this.normal=new Vec2(0,0);this.start=new Vec2(0,0);this.end=new Vec2(0,0)}CollisionInfo.prototype.setNormal=function(a){this.normal=a};CollisionInfo.prototype.getDepth=function(){return this.depth};CollisionInfo.prototype.setDepth=function(a){this.depth=a};CollisionInfo.prototype.getNormal=function(){return this.normal};
CollisionInfo.prototype.setInfo=function(a,b,c){this.depth=a;this.normal=b;this.start=c;this.end=c.add(b.scale(a))};CollisionInfo.prototype.changeDir=function(){this.normal=this.normal.scale(-1);var a=this.start;this.start=this.end;this.end=a};
var Rectangle=function(a,b,c,d,e,f,g,h){Body.call(this,a,b,e,f,g,h);this.type="Rectangle";this.width=c;this.height=d;this.boundRadius=Math.sqrt(c*c+d*d)/2;this.vertex=[];this.faceNormal=[];this.vertex[0]=new Vec2(a-c/2,b-d/2);this.vertex[1]=new Vec2(a+c/2,b-d/2);this.vertex[2]=new Vec2(a+c/2,b+d/2);this.vertex[3]=new Vec2(a-c/2,b+d/2);this.faceNormal[0]=this.vertex[1].subtract(this.vertex[2]);this.faceNormal[0]=this.faceNormal[0].normalize();this.faceNormal[1]=this.vertex[2].subtract(this.vertex[3]);
this.faceNormal[1]=this.faceNormal[1].normalize();this.faceNormal[2]=this.vertex[3].subtract(this.vertex[0]);this.faceNormal[2]=this.faceNormal[2].normalize();this.faceNormal[3]=this.vertex[0].subtract(this.vertex[1]);this.faceNormal[3]=this.faceNormal[3].normalize();this.updateInertia()};Common.extend(Rectangle,Body);Rectangle.prototype.move=function(a){var b;for(b=0;b<this.vertex.length;b++)this.vertex[b]=this.vertex[b].add(a);this.center=this.center.add(a);return this};
Rectangle.prototype.rotate=function(a){this.angle+=a;var b;for(b=0;b<this.vertex.length;b++)this.vertex[b]=this.vertex[b].rotate(this.center,a);this.faceNormal[0]=this.vertex[1].subtract(this.vertex[2]);this.faceNormal[0]=this.faceNormal[0].normalize();this.faceNormal[1]=this.vertex[2].subtract(this.vertex[3]);this.faceNormal[1]=this.faceNormal[1].normalize();this.faceNormal[2]=this.vertex[3].subtract(this.vertex[0]);this.faceNormal[2]=this.faceNormal[2].normalize();this.faceNormal[3]=this.vertex[0].subtract(this.vertex[1]);
this.faceNormal[3]=this.faceNormal[3].normalize();return this};Rectangle.prototype.updateInertia=function(){0===this.invMass?this.inertia=0:(this.inertia=1/this.invMass*(this.width*this.width+this.height*this.height)/12,this.inertia=1/this.inertia)};var Circle=function(a,b,c,d,e,f,g){Body.call(this,a,b,d,e,f,g);this.type="Circle";this.boundRadius=this.radius=c;this.startPoint=Vec2(a,b-c);this.updateInertia()};Common.extend(Circle,Body);
Circle.prototype.move=function(a){this.startPoint=this.startPoint.add(a);this.center=this.center.add(a);return this};Circle.prototype.rotate=function(a){this.angle+=a;this.startPoint=this.startPoint.rotate(this.center,a);return this};Circle.prototype.updateInertia=function(){0===this.invMass?this.interia=0:this.inertia=1/this.invMass*this.radius*this.radius/12};Rectangle.prototype.collisionTest=function(a,b){return"Circle"===a.type?this.collidedRectCirc(a,b):this.collidedRectRect(this,a,b)};
var SupportStruct=function(){this.supportPoint=null;this.supportPointDist=0},tmpSupport=new SupportStruct;Rectangle.prototype.findSupportPoint=function(a,b){var c;tmpSupport.supportPointDist=-9999999;tmpSupport.supportPoint=null;for(var d=0;d<this.vertex.length;d++)c=this.vertex[d].subtract(b),c=c.dot(a),0<c&&c>tmpSupport.supportPointDist&&(tmpSupport.supportPoint=this.vertex[d],tmpSupport.supportPointDist=c)};
Rectangle.prototype.findAxisLeastPenetration=function(a,b){var c,d,e=999999,f=null;c=!0;for(var g=0;c&&g<this.faceNormal.length;)c=this.faceNormal[g],c=c.scale(-1),a.findSupportPoint(c,this.vertex[g]),(c=null!==tmpSupport.supportPoint)&&tmpSupport.supportPointDist<e&&(e=tmpSupport.supportPointDist,f=g,d=tmpSupport.supportPoint),g+=1;c&&(g=this.faceNormal[f].scale(e),b.setInfo(e,this.faceNormal[f],d.add(g)));return c};var collisionInfoR1=new CollisionInfo,collisionInfoR2=new CollisionInfo;
Rectangle.prototype.collidedRectRect=function(a,b,c){var d,e=!1;if(d=a.findAxisLeastPenetration(b,collisionInfoR1))if(e=b.findAxisLeastPenetration(a,collisionInfoR2))collisionInfoR1.getDepth()<collisionInfoR2.getDepth()?(a=collisionInfoR1.getNormal().scale(collisionInfoR1.getDepth()),c.setInfo(collisionInfoR1.getDepth(),collisionInfoR1.getNormal(),collisionInfoR1.start.subtract(a))):c.setInfo(collisionInfoR2.getDepth(),collisionInfoR2.getNormal().scale(-1),collisionInfoR2.start);return d&&e};
Rectangle.prototype.collidedRectCirc=function(a,b){var c=!0,d=-99999,e=0,f,g,h;for(h=0;4>h;++h){g=a.center;f=g.subtract(this.vertex[h]);f=f.dot(this.faceNormal[h]);if(0<f){d=f;e=h;c=!1;break}f>d&&(d=f,e=h)}if(c)c=this.faceNormal[e].scale(a.radius),b.setInfo(a.radius-d,this.faceNormal[e],g.subtract(c));else if(c=g.subtract(this.vertex[e]),h=this.vertex[(e+1)%4].subtract(this.vertex[e]),f=c.dot(h),0>f){d=c.length();if(d>a.radius)return!1;e=c.normalize();c=e.scale(-a.radius);b.setInfo(a.radius-d,e,g.add(c))}else if(c=
g.subtract(this.vertex[(e+1)%4]),h=h.scale(-1),f=c.dot(h),0>f){d=c.length();if(d>a.radius)return!1;e=c.normalize();c=e.scale(-a.radius);b.setInfo(a.radius-d,e,g.add(c))}else if(d<a.radius)c=this.faceNormal[e].scale(a.radius),b.setInfo(a.radius-d,this.faceNormal[e],g.subtract(c));else return!1;return!0};Circle.prototype.collisionTest=function(a,b){return"Circle"===a.type?this.collidedCircCirc(this,a,b):a.collidedRectCirc(this,b)};
Circle.prototype.collidedCircCirc=function(a,b,c){var d=b.center.subtract(a.center),e=a.radius+b.radius,f=d.length();if(f>Math.sqrt(e*e))return!1;0!==f?(a=d.scale(-1).normalize().scale(b.radius),c.setInfo(e-f,d.normalize(),b.center.add(a))):a.radius>b.radius?c.setInfo(e,new Vec2(0,-1),a.center.add(Vec2(0,a.radius))):c.setInfo(e,new Vec2(0,-1),b.center.add(Vec2(0,b.radius)));return!0};var constraintIndex=new Indexer;
function Constraint(a,b,c,d){this.index=constraintIndex.incrementIndex();this.bodyA=a;this.bodyB=b;this.length=c;this.stiffness=d}Constraint.prototype.maintainConstraint=function(){};Constraint.prototype.updateLink=function(){};
function DistanceConstraint(a,b,c,d){Constraint.call(this,a,b,c,d);this.minLength=.005;this.previousRelDist=this.bodyB.center.subtract(this.bodyA.center).length()-this.length;this.reducedMass=1/(1/this.bodyA.invMass+1/this.bodyB.invMass);0===this.bodyA.invMass&&(console.log(this.bodyA.invMass),this.bodyA.invMass=this.reducedMass,this.bodyB.invMass=this.reducedMass);this.initialiseConstraint()}Common.extend(DistanceConstraint,Constraint);
DistanceConstraint.prototype.maintainConstraint=function(a){var b=this.bodyB.center.subtract(this.bodyA.center),c=b.length();b.scale(1/c);var d=c-this.length,e=-(.1/a.updateIntervalInSeconds)*Math.min(d+.8,0);.8>c&&(b-=.8);b=b.scale(1/c);a=b.scale(d+e*a.updateIntervalInSeconds);this.previousRelDist=d;this.bodyA.velocity=this.bodyA.velocity.add(a.scale(this.bodyA.invMass*this.stiffness));this.bodyB.velocity=this.bodyB.velocity.subtract(a.scale(this.bodyB.invMass*this.stiffness));d=Vec2(0,0).angleFromVector(b)-
this.bodyA.angle;a=Vec2(0,0).angleFromVector(b)-this.bodyB.angle;this.bodyA.angularVelocity+=d*this.bodyA.inertia;this.bodyB.angularVelocity-=a*this.bodyB.inertia};DistanceConstraint.prototype.initialiseConstraint=function(){var a=this.bodyB.center.subtract(this.bodyA.center),b=a.length(),c=b-this.length,a=a.scale(1/b);if(0<c||0>c)0==this.bodyB.invMass?this.bodyA.move(a.scale(c)):0==this.bodyA.invMass?this.bodyB.move(a.scale(c)):(this.bodyA.move(a.scale(c/2)),this.bodyB.move(a.scale(-c/2)))};
function NaiveDistance(a,b,c,d){Constraint.call(this,a,b,c,d);this.minLength=.005;a=this.bodyA.center.add(this.bodyB.center);this.constraintLink=new Rectangle(a.x/2,a.y/2,this.bodyA.center.distance(this.bodyB.center),1,0,.2,0,{name:"rod"})}Common.extend(NaiveDistance,Constraint);
NaiveDistance.prototype.maintainConstraint=function(a){var b=this.bodyA.center,c=this.bodyB.center,d=c.subtract(b),e=b.subtract(c),b=d.length(),c=e.length(),e=e.normalize(),d=d.normalize().scale(this.length),f=!1;b<this.minLength&&(b=this.minLength);b>this.length?(a.setInfo(this.length-c/c,e.scale(this.bodyB.friction),this.bodyB.center.add(d)),f=!0):b<this.length&&(a.setInfo(c-this.length/c,e.scale(this.bodyB.friction),this.bodyB.center.add(d)),f=!0);return f};
NaiveDistance.prototype.updateLink=function(){this.middlePoint=this.bodyA.center.add(this.bodyB.center);this.constraintLink.center.x=this.middlePoint.x/2;this.constraintLink.center.y=this.middlePoint.y/2;this.constraintLink.width=this.bodyA.center.distance(this.bodyB.center);this.constraintLink.angle=this.bodyA.center.angleFromVector(this.bodyB.center)};NaiveDistance.prototype.updateConstraint=function(){this.maintainConstraint();this.updateLink()};
function Spring(a,b,c,d,e){Constraint.call(this,a,b,c,d);this.restingAngleA=this.bodyA.angle;this.restingAngleB=this.bodyB.angle;this.centerA=this.bodyA.center;this.dampingConstant=.0025;e&&e.damping&&(this.dampingConstant=e.dampingConstant)}Common.extend(Spring,Constraint);
Spring.prototype.maintainConstraint=function(a){var b,c,d;d=this.bodyB.center.subtract(this.bodyA.center);b=d.length();d=d.scale(1/b);c=b-this.length;b=this.bodyB.velocity.subtract(this.bodyA.velocity).dot(d);c=d.dot(Vec2(this.stiffness*c,this.stiffness*c));d=d.scale(c+b*this.dampingConstant);c=this.bodyA.inertia*this.bodyB.inertia/(this.bodyA.inertia+this.bodyB.inertia);b=-(c/a.updateIntervalInSeconds)*this.stiffness*this.restingAngleA*20-.5*this.bodyA.angle;a=-(c/a.updateIntervalInSeconds)*this.stiffness*
this.restingAngleB*20-.5*this.bodyB.angle;this.bodyA.velocity=this.bodyA.velocity.add(d.scale(this.bodyA.invMass));this.bodyB.velocity=this.bodyB.velocity.subtract(d.scale(this.bodyB.invMass));this.bodyA.angularVelocity+=b;this.bodyB.angularVelocity+=a;this.bodyA.velocity.x+=this.centerA.x-this.bodyA.center.x};function Factory(){}Factory.prototype.createSquareGrid=function(a,b,c,d,e,f,g,h,m){for(var k=0,l=[],n=0;n<f*e;n+=e)for(var p=0;p<f*e;p+=e)l[k]=new Kala.Rectangle(n+a,p+b,c,d,g,h,m),k++;return l};
Factory.prototype.createCircleGrid=function(a,b,c,d,e,f,g,h){for(var m=0,k=[],l=0;l<e*d;l+=d)for(var n=0;n<e*d;n+=d)k[m]=new Kala.Circle(l+a,n+b,c,f,g,h),m++;return k};
var Kala={},Kala=function(){Kala.Vec2=Vec2;Kala.Indexer=Indexer;Kala.Engine=Engine;Kala.Physics=Physics;Kala.Body=Body;Kala.Rectangle=Rectangle;Kala.Circle=Circle;Kala.Render=PixiRender;Kala.Common=Common;Kala.Constraint=Constraint;Kala.DistanceConstraint=DistanceConstraint;Kala.NaiveDistance=NaiveDistance;Kala.Spring=Spring;Kala.Events=Events;Kala.Factory=Factory;return Kala}();
