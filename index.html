<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Kala Physics Engine</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <link rel="stylesheet" href="./docs/css/styles.css" />

    <script type="text/javascript" src="./build/Kala.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>

    <script>
      var HomeApp = function() {
        var width = window.innerWidth,
          height = 300 / 20,
          scale = 20;
        var myCanvas = document.createElement("canvas");
        var canvasContainer = document.getElementById("canvascontainer");
        console.log(width);

        canvasContainer.onselectstart = function() {
          return false;
        };

        canvasContainer.appendChild(myCanvas);

        var engine = new Kala.Engine();
        var render = new Kala.Render(0, 0, "stone", scale, myCanvas);
        // width = render.app.view.width / scale;
        // height = render.app.view.height / scale;
        render.app.renderer.backgroundColor = 0xdbadff;

        window.addEventListener("resize", resize);
        canvasContainer.addEventListener("mousedown", event => {
          console.log("clock!");
          createPolygon(event);
        });

        function createPolygon(event) {
          console.log("click");
          engine.add(
            new RegularPoly(
              event.clientX / scale,
              (event.clientY - 40) / scale,
              Math.floor(Math.random() * 3) + 1,
              Math.floor(Math.random() * 7 + 3),
              1,
              0.2,
              0.3
            )
          );
          engine.allBodies[engine.allBodies.length - 1].rotate(Math.random());
        }

        function resize() {
          var prevWidth = width || 0;

          var parent = render.app.view.parentNode;

          render.app.renderer.resize(parent.clientWidth, 300);

          width = render.app.view.width / scale;

          bounds[1].move(Vec2(width - prevWidth, 0));
        }

        var bounds = [
          new Rectangle(width / 2, 0 - 1, width, 2, 0, 1, 0.2),
          new Rectangle(width + 1, height / 2, 2, height, 0, 1, 0.2),
          new Rectangle(width / 2, height + 1, width, 2, 0, 1, 0.2),
          new Rectangle(0 - 1, height / 2, 2, height, 0, 1, 0.2)
        ];

        render.loader.onComplete.add(() => {
          console.log(width);
          engine.add(bounds);
          engine.initializeEngineCore(render);
          engine.movement = true;
          resize();
          console.log(engine.allBodies);
        });
      };
    </script>
  </head>
  <body onload="HomeApp();">
    <div class="ui menu">
      <a href="" class=" item">Kala</a>
      <a href="" class=" item">Getting Started</a>
      <div class="right menu">
        <a href="" class=" item">Documentation</a>
        <a href="" class=" item">Examples</a>
      </div>
    </div>

    <div class="ui main container">
      <div id="canvascontainer" class="">
        <div>
          <div><h1 class="text">Kala is a 2D Rigid Body Physics Engine</h1></div>
        </div>
      </div>
    </div>
  </body>
</html>
